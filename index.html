<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Marble Launcher</title>

    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" as="style">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Product+Sans:wght@400;700&display=swap" as="style">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Product+Sans:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #080808;
            --card-bg: #1a1a1a;
            --accent: #00e5ff;
            --fav-color: #ffca28;
            --text-main: #ffffff;
            --text-dim: #9aa0a6;
            --font-main: 'Product Sans', 'Segoe UI', system-ui, sans-serif;
            --modal-bg: rgba(20, 20, 20, 0.98);
        }

        * { box-sizing: border-box; outline: none; }
        
        html, body {
            margin: 0; padding: 0;
            background-color: var(--bg-color); color: var(--text-main);
            font-family: var(--font-main);
            height: 100vh; width: 100vw;
            overflow: hidden; 
            display: flex; flex-direction: column;
            -webkit-font-smoothing: antialiased;
        }

        /* --- Loading Screen --- */
        #loader-wrapper {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: var(--bg-color);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s;
        }

        .spinner {
            width: 40px; height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        .loader-text {
            color: var(--text-dim);
            font-size: 0.8rem;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loader-hidden { opacity: 0; visibility: hidden; }

        /* --- Header --- */
        .header {
            flex-shrink: 0; padding: 20px 40px; 
            display: grid;
            grid-template-columns: 1fr auto 1fr; 
            align-items: center;
            background: linear-gradient(to bottom, #111, transparent); 
            border-bottom: 1px solid #222;
            width: 100%;
            z-index: 100;
        }
        
        .header-left { display: flex; justify-content: flex-start; }
        .header-center { display: flex; justify-content: center; }
        .header-right { display: flex; justify-content: flex-end; align-items: center; gap: 20px; }

        .brand-title { 
            font-size: 1.1rem; font-weight: 700; letter-spacing: 0.5px; margin: 0; 
            cursor: pointer; transition: color 0.2s; user-select: none;
        }
        .brand-title:hover { color: var(--accent); }

        .search-container { position: relative; display: flex; align-items: center; width: 380px; }
        .search-input { 
            width: 100%; background: #202124; border: 1px solid #3c4043; color: white; 
            padding: 10px 45px 10px 18px; border-radius: 24px; font-family: var(--font-main);
            font-size: 0.9rem; transition: border-color 0.2s;
        }
        .search-input:focus { border-color: var(--accent); background: #292a2d; }
        .search-icon-btn {
            position: absolute; right: 15px; background: none; border: none;
            color: var(--text-dim); cursor: pointer; font-size: 0.9rem;
        }

        #clock { font-variant-numeric: tabular-nums; font-size: 0.95rem; color: var(--text-main); min-width: 110px; text-align: right; }

        .settings-trigger {
            background: none; border: none; color: var(--text-dim);
            font-size: 1.1rem; cursor: pointer; transition: all 0.3s ease;
            display: flex; align-items: center;
        }
        .settings-trigger:hover { color: var(--accent); transform: rotate(90deg); }

        /* --- Section Headers & Double Line Arrow --- */
        .section-header { 
            font-size: 0.85rem; font-weight: 700; color: var(--text-dim); 
            margin: 35px 0 15px 5px; display: flex; align-items: center; 
            cursor: pointer; user-select: none; width: 100%;
        }

        .section-header span { display: flex; align-items: center; flex-grow: 1; gap: 12px; }

        .section-header span::after {
            content: ""; height: 1px; background: #222;
            flex-grow: 1; margin-right: 15px; 
        }

        .toggle-icon { 
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            color: var(--text-dim); font-size: 0.9rem; flex-shrink: 0;
        }

        .section-header.collapsed .toggle-icon { transform: rotate(-90deg); }
        .grid.collapsed { display: none; }

        /* --- Main Content Area --- */
        .content-viewport { 
            flex-grow: 1; overflow-y: auto; 
            padding: 10px 40px 100px 40px;
        }
        .content-viewport::-webkit-scrollbar { display: none; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 25px; margin-bottom: 40px; }

        .card {
            background-color: var(--card-bg); aspect-ratio: 16/10; border-radius: 16px;
            display: flex; flex-direction: column; justify-content: flex-end; padding: 20px;
            border: 4px solid transparent; transition: all 0.25s;
            position: relative; cursor: pointer; text-decoration: none; color: inherit;
            overflow: hidden;
        }
        .card:hover { border-color: var(--accent); transform: translateY(-5px); background: #222; }
                     
        .fav-btn {
            position: absolute; top: -50px; right: 15px; background: rgba(0,0,0,0.85); width: 38px; height: 38px; 
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: #fff; z-index: 20; border: 1px solid #333; transition: top 0.3s; cursor: pointer;
        }
        .card:hover .fav-btn { top: 15px; } 
        .card.is-favorite .fav-btn { color: var(--fav-color); }
        .card-title { font-size: 0.95rem; font-weight: 700; text-transform: capitalize; opacity: 0; transition: opacity 0.3s; }
        .card.loaded .card-title { opacity: 1; }

        /* --- Fixed Footer --- */
        .footer {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 60px;
            background-color: #0a0a0a; border-top: 1px solid #222;
            padding: 0 40px; display: flex; justify-content: space-between; align-items: center; z-index: 1000;
        }
        .random-msg { color: var(--text-dim); font-size: 0.85rem; font-style: italic; }

        /* --- Settings Modal --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center;
            z-index: 2000; backdrop-filter: blur(8px);
        }
        .modal-content {
            background: var(--modal-bg); width: 420px; padding: 30px; border-radius: 28px;
            border: 1px solid #333; box-shadow: 0 25px 50px rgba(0,0,0,0.5);
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .modal-header h2 { margin: 0; font-size: 1.3rem; }
        .close-modal { background: none; border: none; color: var(--text-dim); font-size: 1.2rem; cursor: pointer; }
        .settings-list { display: flex; flex-direction: column; gap: 10px; }
        .setting-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 12px 15px; background: rgba(255,255,255,0.03); border-radius: 12px;
        }
        .setting-info span { font-size: 0.9rem; font-weight: 700; display: block; }
        .setting-info small { color: var(--text-dim); font-size: 0.75rem; }
        .format-input {
            background: #111; border: 1px solid #444; color: var(--accent);
            padding: 5px 10px; border-radius: 6px; width: 140px; font-family: monospace; font-size: 0.8rem;
        }
        .btn-sm { 
            background: #222; border: 1px solid #444; color: #fff; padding: 8px 16px; 
            border-radius: 10px; font-size: 0.75rem; cursor: pointer; font-family: var(--font-main);
            transition: all 0.2s;
        }
        .btn-sm:hover { border-color: var(--accent); background: #333; }
    </style>
</head>
<body>

    <div id="loader-wrapper">
        <div class="spinner"></div>
        <div class="loader-text">loading..</div>
    </div>

    <div class="header">
        <div class="header-left">
            <h1 class="brand-title" onclick="resetSearch()">GAMES HUB</h1>
        </div>
        <div class="header-center">
            <div class="search-container">
                <input type="text" class="search-input" id="search-bar" placeholder="Search library..." autofocus>
                <button class="search-icon-btn" onclick="clearSearch()">
                    <i class="fa-solid fa-magnifying-glass" id="search-icon"></i>
                </button>
            </div>
        </div>
        <div class="header-right">
            <div id="clock">00:00:00</div>
            <button class="settings-trigger" onclick="toggleSettings()"><i class="fa-solid fa-gear"></i></button>
        </div>
    </div>

    <div class="modal-overlay" id="settings-modal" onclick="if(event.target==this) toggleSettings()">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="close-modal" onclick="toggleSettings()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="settings-list">
                <div class="setting-item">
                    <div class="setting-info">
                        <span>Time Format</span>
                        <small>Use HH, mm, ss, a</small>
                    </div>
                    <input type="text" class="format-input" id="time-format-input" placeholder="hh:mm:ss">
                </div>
                <div class="setting-item">
                    <div class="setting-info"><span>Privacy Mode</span><small>Launch in About:Blank</small></div>
                    <button class="btn-sm" onclick="cloakAB()">Launch</button>
                </div>
                <div class="setting-item">
                    <div class="setting-info"><span>Blob Wrapper</span><small>Launch in Blob URL</small></div>
                    <button class="btn-sm" onclick="cloakBlob()">Launch</button>
                </div>
                <div class="setting-item">
                    <div class="setting-info"><span>Wipe Data</span><small>Clear favs/cookies</small></div>
                    <button class="btn-sm" onclick="clearAppData()">Clear</button>
                </div>
            </div>
        </div>
    </div>

    <div class="content-viewport" id="scroll-container">
        <div id="fav-wrapper" style="display: none;">
            <div class="section-header" id="fav-header" onclick="toggleSection('fav-grid', 'fav-header')">
                <span><i class="fa-solid fa-star"></i> Favorites</span>
                <i class="fa-solid fa-chevron-down toggle-icon"></i>
            </div>
            <div class="grid" id="fav-grid"></div>
        </div>

        <div id="all-wrapper">
            <div class="section-header" id="all-header" onclick="toggleSection('all-grid', 'all-header')">
                <span><i class="fa-solid fa-gamepad"></i> All Games</span>
                <i class="fa-solid fa-chevron-down toggle-icon"></i>
            </div>
            <div class="grid" id="all-grid"></div>
        </div>
    </div>

    <div class="footer">
        <div class="random-msg" id="footer-msg">Loading thoughts...</div>
        <button class="btn-sm" onclick="toggleFS()"><i class="fa-solid fa-expand"></i></button>
    </div>

<script>
    let files = [];

    async function buildList() {
        const response = await fetch(`https://cdn.jsdelivr.net/gh/oliver12418/ugs/games.json?t=${Date.now()}`);
        const data = await response.json(); 
        files = data.map(str => {
            return str.replace(".html", "")
        })
        refreshLibrary() 
    }
    buildList();
    
    const messages = ["Welcome back.", "Ready for a round?", "Game on.", "Loading memories..."];

    let favorites = JSON.parse(localStorage.getItem('fav_games') || '["clgrandtheftautoadvance","clmariokart64","clocarinaoftime","clplantsvszombies","clretrobowl","clsupermario","clsupermario64","clsupersmashbros","clBalatro","clRaft"]');
    let timeFormat = localStorage.getItem('timeFormat') || 'h:mm a';

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const card = entry.target;
                const file = card.dataset.file;
                loadCardContent(card, file);
                observer.unobserve(card);
            }
        });
    }, { root: document.getElementById('scroll-container'), rootMargin: '100px' });

    function init() {
        applyCollapseState('fav-grid', 'fav-header');
        applyCollapseState('all-grid', 'all-header');

        refreshLibrary();
        updateClock();
        setInterval(updateClock, 1000);
        
        document.getElementById('footer-msg').textContent = messages[Math.floor(Math.random() * messages.length)];

        const formatInput = document.getElementById('time-format-input');
        formatInput.value = timeFormat;
        formatInput.addEventListener('input', (e) => {
            timeFormat = e.target.value || 'h:mm a';
            localStorage.setItem('timeFormat', timeFormat);
            updateClock();
        });
    }

    // Loader logic
    window.addEventListener('load', () => {
        const loader = document.getElementById('loader-wrapper');
        setTimeout(() => {
            loader.classList.add('loader-hidden');
        }, 400);
    });

    function toggleSection(gridId, headerId) {
        const grid = document.getElementById(gridId);
        const header = document.getElementById(headerId);
        const isCollapsed = grid.classList.toggle('collapsed');
        header.classList.toggle('collapsed');
        localStorage.setItem(`collapsed_${gridId}`, isCollapsed);
    }

    function applyCollapseState(gridId, headerId) {
        const isCollapsed = localStorage.getItem(`collapsed_${gridId}`) === 'true';
        if (isCollapsed) {
            document.getElementById(gridId).classList.add('collapsed');
            document.getElementById(headerId).classList.add('collapsed');
        }
    }

    function updateClock() {
        const now = new Date();
        const hours = now.getHours();
        const hours12 = hours % 12 || 12;
        const minutes = now.getMinutes().toString().padStart(2, '0');
        const seconds = now.getSeconds().toString().padStart(2, '0');
        const ampm = hours >= 12 ? 'PM' : 'AM';

        let formatted = timeFormat
            .replace(new RegExp('HH', 'g'), hours.toString().padStart(2, '0'))
            .replace(new RegExp('H', 'g'), hours.toString())
            .replace(new RegExp('hh', 'g'), hours12.toString().padStart(2, '0'))
            .replace(new RegExp('h', 'g'), hours12.toString())
            .replace(new RegExp('mm', 'g'), minutes)
            .replace(new RegExp('ss', 'g'), seconds)
            .replace(new RegExp('a', 'g'), ampm);

        document.getElementById('clock').textContent = formatted;
    }

    function toggleSettings() {
        const modal = document.getElementById('settings-modal');
        modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
    }

    function cloakAB() {
        const win = window.open('about:blank', '_blank');
        if (!win) return alert("Pop-up blocked!");
        win.document.body.style.margin = '0';
        win.document.body.style.height = '100vh';
        const iframe = win.document.createElement('iframe');
        iframe.src = window.location.href;
        iframe.style.width = '100%'; iframe.style.height = '100%'; iframe.style.border = 'none';
        win.document.body.appendChild(iframe);
        window.location.replace("https://www.google.com/");
    }

    function cloakBlob() {
        const blob = new Blob([document.documentElement.outerHTML], { type: 'text/html' });
        window.location.href = URL.createObjectURL(blob);
    }

    function clearAppData() { localStorage.clear(); location.reload(); }

    function getSortWeight(str) {
        const char = str.replace(/^cl/, '').charAt(0).toLowerCase();
        if (/[a-z]/.test(char)) return 1; 
        if (/[0-9]/.test(char)) return 2; 
        return 3; 
    }

    function refreshLibrary() {
        const term = document.getElementById('search-bar').value.toLowerCase().replace(" ", "");
        const icon = document.getElementById('search-icon');
        icon.className = term.length > 0 ? 'fa-solid fa-xmark' : 'fa-solid fa-magnifying-glass';

        const filtered = files
            .filter(f => f.toLowerCase().includes(term))
            .sort((a,b) => {
                const wa = getSortWeight(a), wb = getSortWeight(b);
                return wa !== wb ? wa - wb : a.localeCompare(b, undefined, {numeric: true});
            });

        const favs = filtered.filter(f => favorites.includes(f));
        const others = filtered.filter(f => !favorites.includes(f));
        
        document.getElementById('fav-wrapper').style.display = favs.length > 0 ? 'block' : 'none';
        renderSection(document.getElementById('fav-grid'), favs);
        renderSection(document.getElementById('all-grid'), others);
    }

    function renderSection(container, list) {
        container.innerHTML = '';
        list.forEach((file) => {
            const card = document.createElement('div');
            card.className = `card ${favorites.includes(file) ? 'is-favorite' : ''}`;
            card.dataset.file = file;
            container.appendChild(card);
            observer.observe(card);
        });
    }

    function normalizeFileName(name) {
        if (name.includes('.') && name.lastIndexOf('.') > 0) return name;
        return name + '.html';
    }

    function loadCardContent(card, file) {
        const cleanName = file.replace(/^cl/, '').trim();
        card.innerHTML = `<div class="fav-btn"><i class="fa-solid fa-star"></i></div><div class="card-title">${cleanName}</div>`;
        card.classList.add('loaded');
        
        card.onclick = (e) => {
            if(e.target.closest('.fav-btn')) {
                favorites = favorites.includes(file) ? favorites.filter(f => f !== file) : [...favorites, file];
                localStorage.setItem('fav_games', JSON.stringify(favorites));
                refreshLibrary();
            } else {
                const normalized = normalizeFileName(file);
                const encoded = encodeURIComponent(normalized);
                
                fetch(`https://cdn.jsdelivr.net/gh/oliver12418/ugs/games/${encoded}?t=${Date.now()}`)
                    .then(response => response.text())
                    .then(text => {
                        const newWin = window.open("about:blank", "_blank");
                        if (newWin) {
                            newWin.document.open();
                            newWin.document.write(text);
                            newWin.document.close();
                        }
                    })
                    .catch(err => console.error("Game fetch failed:", err));
            }
        };
    }

    function resetSearch() { document.getElementById('search-bar').value = ""; refreshLibrary(); }
    function clearSearch() { document.getElementById('search-bar').value = ""; refreshLibrary(); document.getElementById('search-bar').focus(); }
    function toggleFS() { !document.fullscreenElement ? document.documentElement.requestFullscreen() : document.exitFullscreen(); }

    document.getElementById('search-bar').addEventListener('input', refreshLibrary);
    init();
</script>
</body>
</html>